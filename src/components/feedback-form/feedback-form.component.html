<div class="relative z-20" aria-labelledby="modal-title" role="dialog" aria-modal="true">
  <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
  <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
    <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
      <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
        <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
          <div class="sm:flex sm:items-start">
            <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10">
              <svg class="h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M10.25 2.25a.75.75 0 00-1.5 0v1.5c-2.09.23-3.75 2-3.75 4.125v1.233c0 .324.032.642.094.95l.092.463c.273 1.368.52 2.735.52 4.129 0 1.394-.247 2.761-.52 4.129l-.092.463a2.625 2.625 0 00-.094.95v1.233c0 2.125 1.66 3.895 3.75 4.125v1.5a.75.75 0 001.5 0v-1.5a4.125 4.125 0 004-4.03v-1.283c0-.324-.032-.642-.094-.95l-.092-.463c-.273-1.368-.52-2.735-.52-4.129 0-1.394.247-2.761.52-4.129l.092-.463c.062-.308.094-.626.094-.95V7.875c0-2.125-1.66-3.895-3.75-4.125v-1.5zM10 6.375a1.875 1.875 0 113.75 0v1.233c0 .28-.027.554-.08.818l-.093.463c-.273 1.367-.52 2.735-.52 4.129 0 1.394.247 2.761.52 4.129l.093.463c.053.264.08.537.08.818v1.233c0 1.036-.84 1.875-1.875 1.875s-1.875-.84-1.875-1.875v-1.233c0-.28.027.554.08-.818l.093-.463c.273-1.367.52-2.735.52-4.129 0-1.394-.247-2.761-.52-4.129l-.093-.463a2.37 2.37 0 01-.08-.818V6.375z" />
              </svg>
            </div>
            <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full">
              <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Provide Feedback</h3>
              <div class="mt-4 space-y-4">
                <div>
                  <label for="feedback-type" class="block text-sm font-medium leading-6 text-gray-900">Feedback Type</label>
                  <select id="feedback-type" name="feedback-type" [ngModel]="feedbackType()" (ngModelChange)="feedbackType.set($event)" class="mt-1 block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-blue-600 sm:text-sm sm:leading-6">
                    <option value="Suggestion">Suggestion</option>
                    <option value="Bug">Bug Report</option>
                    <option value="Error">Error Report</option>
                    <option value="Question">Question</option>
                  </select>
                </div>
                <div>
                  <label for="feedback-title" class="block text-sm font-medium leading-6 text-gray-900">Title</label>
                  <input type="text" name="feedback-title" id="feedback-title" [ngModel]="title()" (ngModelChange)="title.set($event)" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6" placeholder="A brief summary">
                </div>
                <div>
                  <label for="feedback-description" class="block text-sm font-medium leading-6 text-gray-900">Description</label>
                  <textarea name="feedback-description" id="feedback-description" rows="4" [ngModel]="description()" (ngModelChange)="description.set($event)" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6" placeholder="Please provide as much detail as possible."></textarea>
                </div>

                <!-- Attachment Section -->
                <div>
                  <label for="attachment-file" class="block text-sm font-medium leading-6 text-gray-900">Attach an Image (Optional)</label>
                  <p class="text-xs text-gray-500 mb-2">Max 5MB. Allowed formats: JPG, PNG, GIF, WEBP.</p>
                  
                  @if (!attachment()) {
                    <div class="mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10">
                      <div class="text-center">
                        <svg class="mx-auto h-12 w-12 text-gray-300" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                          <path fill-rule="evenodd" d="M1.5 6a2.25 2.25 0 012.25-2.25h16.5A2.25 2.25 0 0122.5 6v12a2.25 2.25 0 01-2.25 2.25H3.75A2.25 2.25 0 011.5 18V6zM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0021 18v-1.94l-2.69-2.689a1.5 1.5 0 00-2.12 0l-.88.879.97.97a.75.75 0 11-1.06 1.06l-5.16-5.159a1.5 1.5 0 00-2.12 0L3 16.061zm10.125-7.81a1.125 1.125 0 112.25 0 1.125 1.125 0 01-2.25 0z" clip-rule="evenodd" />
                        </svg>
                        <div class="mt-4 flex text-sm leading-6 text-gray-600">
                          <label for="attachment-file" class="relative cursor-pointer rounded-md bg-white font-semibold text-blue-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-blue-600 focus-within:ring-offset-2 hover:text-blue-500">
                            <span>Upload a file</span>
                            <input #fileInput id="attachment-file" name="attachment-file" type="file" class="sr-only" (change)="onFileSelected($event)" accept="image/jpeg,image/png,image/gif,image/webp">
                          </label>
                          <p class="pl-1">or drag and drop</p>
                        </div>
                      </div>
                    </div>
                  } @else {
                    <div class="mt-2 flex items-center justify-between rounded-lg border border-gray-200 bg-gray-50 p-3">
                      <div class="flex items-center space-x-3 overflow-hidden">
                        <svg class="h-6 w-6 text-green-500 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                        </svg>
                        <div class="text-sm overflow-hidden">
                          <p class="font-medium text-gray-800 truncate">{{ attachment()?.name }}</p>
                          <p class="text-gray-500">{{ (attachment()!.size / 1024 / 1024).toFixed(2) }} MB</p>
                        </div>
                      </div>
                      <button (click)="removeAttachment(fileInput)" type="button" class="text-gray-500 hover:text-red-600 flex-shrink-0 ml-4">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
                        </svg>
                      </button>
                    </div>
                  }
                  
                  @if(validationError()) {
                    <p class="mt-2 text-sm text-red-600">{{ validationError() }}</p>
                  }
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
          <button type="button" (click)="submit()" [disabled]="!title() || !description()" class="inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 sm:ml-3 sm:w-auto disabled:bg-blue-300 disabled:cursor-not-allowed">Submit</button>
          <button type="button" (click)="close()" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>