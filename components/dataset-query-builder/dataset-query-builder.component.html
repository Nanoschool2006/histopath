<div class="bg-white p-6 rounded-lg shadow">
  <div class="flex items-center space-x-3">
    <svg class="w-7 h-7 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z" />
    </svg>
    <h2 class="text-xl font-semibold text-gray-900">Dataset Query Builder</h2>
  </div>

  <div class="mt-4 space-y-4">
    <!-- Natural Language Input -->
    <div>
      <label for="cohort-description" class="flex items-center space-x-2 text-sm font-medium text-gray-700">
        <svg class="w-5 h-5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.624L16.5 21.75l-.398-1.126a3.375 3.375 0 00-2.456-2.456L12.75 18l1.126-.398a3.375 3.375 0 002.456-2.456L16.5 14.25l.398 1.126a3.375 3.375 0 002.456 2.456L20.25 18l-1.126.398a3.375 3.375 0 00-2.456 2.456z" />
        </svg>
        <span>Describe your cohort</span>
      </label>
      <div class="mt-1 flex items-center space-x-2">
        <input type="text" id="cohort-description" [ngModel]="queryText()" (ngModelChange)="queryText.set($event)" (keyup.enter)="handleQuery()"
               placeholder="e.g., show me all adenocarcinoma cases in female patients over 50 with lymphocytic infiltration" 
               class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
        <button (click)="handleQuery()" [disabled]="isLoading()"
                class="rounded-md bg-gray-700 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-600 disabled:opacity-50">
          Go
        </button>
      </div>
    </div>
    
    <!-- Filters & Actions -->
    <div class="border-t border-gray-200 pt-4">
      <h3 class="text-sm font-medium text-gray-700">Query Filters</h3>
      <div class="mt-2 flex items-center space-x-3">
        <button class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
          <svg class="w-5 h-5 mr-1.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
          </svg>
          Add Filter Manually
        </button>
        <button (click)="runQuery()" [disabled]="isLoading()"
                class="inline-flex items-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 disabled:opacity-50">
          <svg class="w-5 h-5 mr-1.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
          </svg>
          Run Query ({{ resultCount() }})
        </button>
        <button class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
          <svg class="w-5 h-5 mr-1.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10.75 2.75a.75.75 0 00-1.5 0v8.614L6.295 8.235a.75.75 0 10-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 00-1.09-1.03l-2.955 3.129V2.75z" />
            <path d="M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z" />
          </svg>
          Export CSV
        </button>
      </div>
    </div>

    <!-- Query Results -->
    <div class="border-t border-gray-200 pt-4">
      <h3 class="text-sm font-medium text-gray-700">Query Results</h3>
      <div class="mt-2 text-sm text-gray-600 bg-gray-50 rounded p-4 min-h-[50px]">
        @if (isLoading()) {
          <p>Running query...</p>
        } @else if (results()) {
          @if(results()!.length > 0) {
            <p>Found {{ resultCount() }} cases matching your criteria.</p>
            <!-- A simple list view of results for now -->
            <ul class="list-disc list-inside mt-2">
              @for(case of results()!.slice(0, 5); track case.id) {
                <li>{{ case.accession_number }} - {{ case.patient.name }}</li>
              }
              @if (results()!.length > 5) {
                <li>... and {{ results()!.length - 5 }} more.</li>
              }
            </ul>
          } @else {
            <p>No results found for the specified query.</p>
          }
        } @else {
          <p>Run a query to see results</p>
        }
      </div>
    </div>
  </div>
</div>